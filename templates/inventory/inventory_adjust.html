{% extends 'base.html' %}
{% load static %}

{% block title %}Adjust Inventory{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Adjust Inventory Item</h2>
    <form method="post" id="adjustForm">
        {% csrf_token %}
        <div class="mb-3">
            <label for="itemId" class="form-label">Item ID</label>
            <input type="text" class="form-control" id="itemId" name="item" value="{{ item_id }}" readonly>
        </div>
        <div class="mb-3">
            <label for="quantity" class="form-label">Quantity Change</label>
            <input type="number" class="form-control" id="quantity" name="quantity" required>
        </div>
        <div class="mb-3">
            <label for="reason" class="form-label">Reason</label>
            <input type="text" class="form-control" id="reason" name="reason" value="Manual adjustment">
        </div>
        <button type="submit" class="btn btn-primary">Submit Adjustment</button>
    </form>
    <div id="result" class="mt-3"></div>
</div>
<script>
document.getElementById('adjustForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const itemId = document.getElementById('itemId').value;
    const quantity = parseInt(document.getElementById('quantity').value);
    const reason = document.getElementById('reason').value;
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';
    try {
        const response = await fetch(`/api/v1/inventory/levels/${itemId}/adjust_stock/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({ quantity: quantity, reason: reason })
        });
        const data = await response.json();
        if (response.ok) {
            resultDiv.innerHTML = '<div class="alert alert-success">Stock adjusted successfully.</div>';
        } else {
            resultDiv.innerHTML = `<div class="alert alert-danger">Error: ${data.error || 'Adjustment failed.'}</div>`;
        }
    } catch (err) {
        resultDiv.innerHTML = '<div class="alert alert-danger">Request failed.</div>';
    }
});
</script>
{% endblock %}
